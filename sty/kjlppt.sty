% kjlppt.sty - Yonsei FCAI Lab Beamer Style
% Provides a customized Beamer style using CambridgeUS theme,
% Yonsei University official colors, navigation bars, and footer logos.

\ProvidesPackage{kjlppt}

%%────────────────────────────────────────────────
%% Beamer Theme & Navigation Overrides
% \PassOptionsToClass{aspectratio=169}{beamer}
\usetheme{CambridgeUS}
\useoutertheme{infolines}
\beamertemplatenavigationsymbolsempty
\setbeamertemplate{caption}[numbered]
\setbeamertemplate{sections/subsections in toc}[square]

%%────────────────────────────────────────────────
%% Basic Packages and Fonts
\usepackage[utf8]{inputenc}
\usepackage{kotex}
\usepackage{lmodern}
\usepackage{graphicx}
\usepackage{caption}
\usepackage{url}
\usepackage{setspace}
\usepackage{indentfirst}
\usepackage{multicol}
\usepackage{array}
\usepackage{booktabs}
\usepackage{textcomp}
\usepackage{hanging}

%%────────────────────────────────────────────────
%% Miscellaneous Packages
\usepackage{xparse}
\usepackage{tcolorbox}
\usepackage{pgfpages}
\usepackage{arydshln}
\usepackage[style=numeric]{biblatex}

%%────────────────────────────────────────────────
%% Theme palettes & frametitle
\setbeamercolor{structure}{fg=yonseiblue}
\setbeamercolor{palette primary}{bg=yonseiblue,fg=white}
\setbeamercolor{palette secondary}{bg=yonseiblue,fg=white}
\setbeamercolor{palette tertiary}{bg=yonseiblue,fg=white}
\setbeamercolor{frametitle}{bg=yonseisilv,fg=white}
\setbeamercolor{progress bar in head/foot}{fg=yonseiblue,bg=yonseisilv}
\setbeamercolor{title}{fg=yonseiblue}
\setbeamercolor{subtitle}{fg=yonseiblue}

%%────────────────────────────────────────────────
%% Yonsei University Official Colors
\usepackage{xcolor}
\definecolor{yonseiblue}{HTML}{003876}   % Primary Blue
\definecolor{yonseisilv}{HTML}{939598}   % Secondary Silver
\definecolor{yonseigold}{HTML}{B38C45}   % Accent Gold
\definecolor{yonseilight}{HTML}{4169E1}
\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{myred}{rgb}{0.545,0,0}
\definecolor{myblue}{rgb}{0,0,0.545}
\definecolor{mygray}{rgb}{0.4,0.4,0.4}
\definecolor{mydarkblue}{rgb}{0.0,0.0,0.6}
\definecolor{mybrown}{HTML}{994213}
\definecolor{myorchid}{HTML}{660099}

%%────────────────────────────────────────────────
%% Lists & Enumerations (enumitem overrides)
\usepackage{enumitem}
\setlist[enumerate,1]{label=\arabic*.,ref=\arabic*}
\setlist[enumerate,2]{label=(\roman*),ref=\roman*}
\setlist[enumerate,3]{label=\alph*),ref=\alph*}
\setlist[itemize,1]{label=\textbullet}
\setlist[itemize,2]{label=\textbullet}
\setlist[itemize,3]{label=\textbullet}
\setbeamertemplate{itemize item}[circle]
\setbeamertemplate{itemize subitem}[circle]
\setbeamertemplate{itemize subsubitem}[circle]

%%────────────────────────────────────────────────
%% Math Packages
\usepackage{amsmath,amsthm,amssymb,amsfonts}
\usepackage{mathtools,nccmath}
\usepackage{stmaryrd}
\usepackage{proof}
\usepackage{mathpartir}
\usepackage{mismath}
\DeclarePairedDelimiterX\set[1]{\lbrace}{\rbrace}{\def\mid{\;\delimsize\vert\;}#1} % usage: \set*{ n \in \mathbb{N} \mid x < 3 }

%%────────────────────────────────────────────────
%% Algorithms
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

%%────────────────────────────────────────────────
%% TikZ
\usepackage{tikz}
\usetikzlibrary{cd}
\usepackage{tikz-cd}

%%────────────────────────────────────────────────
%% Make below blank
\usepackage{etoolbox}
\makeatletter
\pretocmd{\beamer@@frametitle}{\vspace{-0.7em}}{}{}
\makeatother

%%────────────────────────────────────────────────
%% Footnote
\setbeamertemplate{footnote}{
  \hspace{2.5em}\makebox[1em][l]{\insertfootnotemark}{\scriptsize\insertfootnotetext}\par
}

%%────────────────────────────────────────────────
%% Code Listings
\usepackage{listings}
\lstdefinestyle{py}{
  language=Python,
  backgroundcolor=\color{gray!10},
  commentstyle=\color{mygreen}\itshape,
  keywordstyle=\color{blue},
  stringstyle=\color{red},
  numberstyle=\tiny\color{mygray},
  identifierstyle=\color{black},
  basicstyle=\ttfamily\footnotesize\linespread{0.6}\color{black},
  keepspaces=true,
  showstringspaces=false,
  numbers=left,
  numbersep=5pt,
  tabsize=4,
  breaklines=true,
  captionpos=b,
  frame=single,
  rulecolor=\color{black},
  mathescape,       
  showspaces=false,               
  showstringspaces=false,
  showtabs=false,
  sensitive=true,
  stepnumber=1,                   
  tabsize=4,                     
  title=\lstname,
  xleftmargin=.02\textwidth,
  xrightmargin=.02\textwidth,
}
\definecolor{rocqBG}{HTML}{FBFBFB}
\definecolor{rocqFrame}{HTML}{E0E0E0}
\definecolor{rocqComment}{rgb}{0,0.6,0}
\definecolor{rocqString}{HTML}{BB1515}
\lstdefinelanguage{Coq}{
  sensitive=true,
  alsoletter={'},              % allow x' identifiers
  morecomment=[s]{(*}{*)},
  morestring=[b]",
  morekeywords=[1]{
    Section,Module,End,Require,Import,Export,From,Load,Include,
    Variable,Variables,Parameter,Parameters,Axiom,Axioms,Hypothesis,Hypotheses,
    Definition,Let,Ltac,Fixpoint,CoFixpoint,Inductive,CoInductive,Record,Structure,Variant,
    Class,Instance,Existing,Context,Local,Global,
    Universe,Universes,Constraint,Polymorphic,Monomorphic,
    Notation,Infix,Reserved,Scope,Open,Close,Bind,Delimit,Arguments,Implicit,Implicits,Generalizable,
    Canonical,Coercion,Hint,Resolve,
    Theorem,Lemma,Proposition,Corollary,Fact,Remark,Example,Goal,
    Check,Compute,Eval,Print,Search,About,Locate,Fail
  },
  morekeywords=[2]{
    forall,exists,exists2,fun,fix,cofix,struct,
    match,with,end,as,in,return,let,if,then,else,for,of,is,where,
    by,repeat,try,now,first,do
  },
  morekeywords=[3]{Type,Prop,Set,SProp},
  morekeywords=[4]{
    intro,intros,apply,eapply,exact,refine,assumption,trivial,
    constructor,split,left,right,exists,
    destruct,induction,case,elim,remember,revert,clear,subst,rename,pose,
    assert,have,suff,suffices,cut,replace,change,unfold,fold,
    simpl,cbn,cbv,hnf,compute,red,
    rewrite,erewrite,setoid_rewrite,autorewrite,
    inversion,injection,congruence,discriminate,
    auto,eauto,tauto,firstorder,
    lia,nlia,omega,ring,field,
    done,
    wp_apply,wp_store,wp_alloc,wp_pure,wp_pures,wp_load,wp_bind,wp_cmpxchg_suc,
    iIntros,iModIntro,iInv,iSplitL,iSplitR,iSplit,iApply,iNext,iMod,iNext,iLeft,iRight,iExists,iFrame,iPureIntro
  },
  morekeywords=[5]{Proof,Qed,Defined,Admitted,Abort},
}
\lstdefinestyle{rocq}{
  language=Coq,
  backgroundcolor=\color{gray!10},
  commentstyle=\ttfamily\color{rocqComment},
  stringstyle=\color{rocqString},
  basicstyle=\ttfamily\footnotesize\linespread{0.6}\color{black},
  identifierstyle=\ttfamily\color{black},
  numberstyle=\tiny\color{mygray},
  keywordstyle=[1]\ttfamily\color{mybrown}\slshape\bfseries,
  keywordstyle=[2]\color{myorchid}\itshape,
  keywordstyle=[3]\color{blue}\bfseries,
  keywordstyle=[4]\color{yonseiblue},
  keywordstyle=[5]\rmfamily\color{mybrown}\itshape,
  keepspaces=true,
  columns=fullflexible,
  showstringspaces=false,
  numbers=left,
  numbersep=5pt,
  tabsize=4,
  breaklines=true,
  captionpos=b,
  frame=single,
  rulecolor=\color{black},
  mathescape,    
  showspaces=false,               
  showstringspaces=false,
  showtabs=false,
  sensitive=true,
  stepnumber=1,                   
  tabsize=4,                     
  title=\lstname,
  xleftmargin=.02\textwidth,
  xrightmargin=.02\textwidth,
}
\makeatletter
\let\c@algocf\c@lstlisting
\makeatother
\makeatletter
\let\c@algorithm\c@lstlisting
\makeatother
\makeatletter
\patchcmd{\lst@OutputOther}
  {\let\lst@thestyle\lst@currstyle}{\ifx\lst@currstyle\relax \let\lst@thestyle\lst@identifierstyle \else \let\lst@thestyle\lst@currstyle\fi}{}{\PackageWarning{kjlppt}{Failed to patch \string\lst@OutputOther}}
\let\lst@kjl@preescstyle\relax
\patchcmd{\lst@Escape}
  {\lst@TrackNewLines\lst@OutputLostSpace \lst@XPrintToken}{\global\let\lst@kjl@preescstyle\lst@currstyle \lst@TrackNewLines\lst@OutputLostSpace \lst@XPrintToken}{}{\PackageWarning{kjlppt}{Failed to patch \string\lst@Escape}}
\lst@AddToHook{SelectCharTable}{%
  \lst@ifmathescape
    \lst@Escape{\$}{\$}%
      {%
        \setbox\@tempboxa=\hbox\bgroup
          \ifx\lst@kjl@preescstyle\relax
            \let\lst@kjl@preescstyle\lst@identifierstyle
          \fi
          \lst@kjl@preescstyle\bgroup$%
      }%
      {%
        $\egroup \egroup \lst@CalcLostSpaceAndOutput
      }%
  \fi}
\makeatother

%%────────────────────────────────────────────────
%% Hyperref & cleveref setup
\makeatletter
\Hy@implicittrue
\makeatother
\usepackage{hyperref}
\usepackage[capitalize,nameinlink]{cleveref}

\crefdefaultlabelformat{#2{#1}#3}
\crefname{table}{{Table}}{{Tables}}
\Crefname{table}{{Table}}{{Tables}}
\crefname{section}{{Section}}{{Sections}}
\Crefname{section}{{Section}}{{Sections}}
\crefname{theorem}{{Theorem}}{{Theorems}}
\Crefname{theorem}{{Theorem}}{{Theorems}}
\crefname{definition}{{Definition}}{{Definitions}}
\Crefname{definition}{{Definition}}{{Definitions}}
\crefname{fact}{{Fact}}{{Facts}}
\Crefname{fact}{{Fact}}{{Facts}}
\crefname{lemma}{{Lemma}}{{Lemmas}}
\Crefname{lemma}{{Lemma}}{{Lemmas}}
\crefname{corollary}{{Corollary}}{{Corollaries}}
\Crefname{corollary}{{Corollary}}{{Corollaries}}
\crefname{axiom}{{Axiom}}{{Axioms}}
\Crefname{axiom}{{Axiom}}{{Axioms}}
\crefname{notation}{{Notation}}{{Notations}}
\Crefname{notation}{{Notation}}{{Notations}}
\crefname{remark}{{Remark}}{{Remarks}}
\Crefname{remark}{{Remark}}{{Remarks}}
\crefname{lstlisting}{{Listing}}{{Listings}}
\Crefname{lstlisting}{{Listing}}{{Listings}}
\newcommand{\boldref}[1]{\textbf{\cref{#1}}}
\newcommand{\pptref}[1]{\color{yonseiblue}{\cref{#1}}}

%%────────────────────────────────────────────────
%% Bibliography
\usepackage[style=numeric]{biblatex}

%%────────────────────────────────────────────────
%% Custom Column Type
\newcolumntype{M}[1]{>{\centering\arraybackslash}m{#1}}
\renewcommand{\arraystretch}{1.3}

%%────────────────────────────────────────────────
%% Symbol Font Fix
\SetSymbolFont{stmry}{bold}{U}{stmry}{m}{n}

% Navigation bar colors
\setbeamercolor{section in head/foot}{bg=yonseiblue, fg=white}
\setbeamerfont{section in head/foot}{size=\scriptsize}
\setbeamercolor{subsection in head/foot}{bg=white, fg=yonseiblue}
\setbeamerfont{subsection in head/foot}{size=\scriptsize}

%%────────────────────────────────────────────────
%% Custom Frame Title
\setbeamertemplate{frametitle}{
  \vspace{-0.7ex}
  \begin{beamercolorbox}[wd=\paperwidth,ht=2.3ex,dp=1ex,leftskip=0.5em,rightskip=0.5em]{frametitle}
    \usebeamerfont{frametitle}\insertframetitle
  \end{beamercolorbox}
}

%%────────────────────────────────────────────────
%% Custom Footline (two logos at bottom corners)
\setbeamertemplate{footline}{%
  \leavevmode%
  \begin{beamercolorbox}[wd=\paperwidth,ht=4ex,dp=1.5ex,leftskip=1em,rightskip=1em]{author in head/foot}%
    \includegraphics[height=0.8cm]{pics/YonseiUniversityEmblem.png}%
    \hfill
    \includegraphics[height=0.8cm]{pics/fcai_lab_logo.png}%
    \newline
    \footnotesize
    \usebeamerfont{author in head/foot}\textbf{\insertshortauthor}%
    \hfill
    \usebeamerfont{page number in head/foot}\textbf{\insertframenumber{}} \textbf{/} \textbf{\inserttotalframenumber}
  \end{beamercolorbox}%
}

%%────────────────────────────────────────────────
%% Custom Commands & Environments
\renewcommand*{\bibfont}{\small}
\newcommand{\makereferences}{
  \nocite{*}
  \begingroup
  \setlength\bibitemsep{0pt}
  \printbibliography
  \endgroup
}

\newcommand{\inlinedef}[1]{\emph{\textbf{#1}}}
\newcommand{\powerset}{\mathcal{P}}
\newcommand{\concat}{\ensuremath{+\!\!\!\!+\,}}
\newcommand{\listunit}[1]{[#1]}
\newcommand{\bind}{\ensuremath{>\!\!>\!=}}

\newenvironment{mkparagraph}[1][]
{ \noindent \textbf{{#1}.} }
{ \hfill $ \dashv $ }

\endinput
